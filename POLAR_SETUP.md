# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Polar Flow –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Polar Flow –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º T-Sync –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Å–≤–æ–∏ –∞–∫–∫–∞—É–Ω—Ç—ã Polar –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –∏ —Å—Ç–∞—Ç—É—Å–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- üîê **OAuth 2.0 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Polar Flow
- üìä **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫** —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- ‚ù§Ô∏è **–î–∞–Ω–Ω—ã–µ –æ –ø—É–ª—å—Å–µ** (—Å—Ä–µ–¥–Ω–∏–π, –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π)
- üèÉ **–ú–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫** (–¥–∏—Å—Ç–∞–Ω—Ü–∏—è, –≤—Ä–µ–º—è, –∫–∞–ª–æ—Ä–∏–∏)
- üìà **–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** –∏ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- üìÅ **–ó–∞–≥—Ä—É–∑–∫–∞ TCX —Ñ–∞–π–ª–æ–≤** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `ConnectedAccountsSimple` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `PolarAuthResult` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `polar-service.ts` - —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Polar API

### Backend (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- OAuth 2.0 –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Polar API

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö API –∫–ª—é—á–µ–π:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [Polar Developer Portal](https://www.polar.com/accesslink/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–æ–ª—É—á–∏—Ç–µ `client_id` –∏ `client_secret`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ redirect URI: `http://localhost:5173/auth/polar/callback`

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–í —Ñ–∞–π–ª–µ `client/src/lib/integrations/polar-service.ts` –∑–∞–º–µ–Ω–∏—Ç–µ –¥–µ–º–æ-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```typescript
const POLAR_CONFIG = {
  baseUrl: 'https://www.polar.com/accesslink/3',
  authUrl: 'https://flow.polar.com/oauth2/authorization',
  tokenUrl: 'https://www.polar.com/accesslink/3/oauth/token',
  scope: ['read', 'read_activities', 'read_profile'],
  clientId: '87d902b9-ACCH-4579-a636-a9e342ae090b',
  clientSecret: '326c0ac7-332c-4a8a-8174-d47ad6538d2c',
  redirectUri: 'http://localhost:5173/auth/polar/callback'
};
```

### 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ client:

```env
VITE_POLAR_CLIENT_ID=–≤–∞—à_client_id
VITE_POLAR_CLIENT_SECRET=–≤–∞—à_client_secret
VITE_POLAR_REDIRECT_URI=http://localhost:5173/auth/polar/callback
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ "–ú–æ–∏ –¥–∞–Ω–Ω—ã–µ" ‚Üí "–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã"
2. –ù–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç" –¥–ª—è Polar Flow
3. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Polar
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. –ê–∫–∫–∞—É–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

1. –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å"
2. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
3. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π —Å –¥–µ—Ç–∞–ª—è–º–∏
4. –î–æ—Å—Ç—É–ø–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ TCX —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç –∫–Ω–æ–ø–∫–æ–π "–û—Ç–∫–ª—é—á–∏—Ç—å"
2. –í—Å–µ —Ç–æ–∫–µ–Ω—ã —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ localStorage
3. –î–∞–Ω–Ω—ã–µ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è

## API Endpoints

### Polar Flow API v3

- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: `https://flow.polar.com/oauth2/authorization`
- **–¢–æ–∫–µ–Ω—ã**: `https://www.polar.com/accesslink/3/oauth/token`
- **–ü—Ä–æ—Ñ–∏–ª—å**: `https://www.polar.com/accesslink/3/users/profile`
- **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**: `https://www.polar.com/accesslink/3/users/activity`

### Scopes

- `read` - –±–∞–∑–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `read_activities` - —á—Ç–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- `read_profile` - —á—Ç–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ—Ñ–∏–ª—è

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### PolarActivity
```typescript
interface PolarActivity {
  id: string;
  name: string;
  type: string;
  startTime: string;
  duration: number;
  distance?: number;
  calories: number;
  averageHeartRate?: number;
  maxHeartRate?: number;
  averageSpeed?: number;
  maxSpeed?: number;
  route?: PolarRoute;
  trainingLoad?: number;
  recoveryTime?: number;
}
```

### PolarUser
```typescript
interface PolarUser {
  id: string;
  username: string;
  email: string;
  firstName: string;
  lastName: string;
  weight?: number;
  height?: number;
  maxHeartRate?: number;
  restingHeartRate?: number;
  vo2Max?: number;
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

1. **–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - –Ω–µ–≤–µ—Ä–Ω—ã–µ API –∫–ª—é—á–∏
2. **–û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∞** - –∏—Å—Ç–µ–∫—à–∏–π –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
3. **–û—à–∏–±–∫–∞ —Å–µ—Ç–∏** - –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Polar API
4. **–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** - –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### OAuth 2.0 Flow

1. **State –ø–∞—Ä–∞–º–µ—Ç—Ä** - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫
2. **HTTPS —Ç–æ–ª—å–∫–æ** - –≤—Å–µ API –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. **–¢–æ–∫–µ–Ω—ã –≤ localStorage** - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ backend
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - refresh —Ç–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

1. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É OAuth –Ω–∞ backend
2. –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–µ–º–æ —Ä–µ–∂–∏–º

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–º–æ-—Å–µ—Ä–≤–∏—Å —Å –∏–º–∏—Ç–∞—Ü–∏–µ–π API –≤—ã–∑–æ–≤–æ–≤:
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–µ–º–æ-—Ç–æ–∫–µ–Ω—ã
- –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- –ò–º–∏—Ç–∏—Ä—É—é—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–î–µ–º–æ-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–∫–ª—é—á–∞—é—Ç:
- –ë–µ–≥ (10–∫–º, 1 —á–∞—Å)
- –í–µ–ª–æ—Å–∏–ø–µ–¥ (25–∫–º, 1.5 —á–∞—Å–∞)
- –°–∏–ª–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (45 –º–∏–Ω—É—Ç)
- –ü–ª–∞–≤–∞–Ω–∏–µ (1.5–∫–º, 30 –º–∏–Ω—É—Ç)
- –ô–æ–≥–∞ (1 —á–∞—Å)

## –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)
- [ ] –†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Polar API
- [ ] Backend –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ OAuth
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤)
- [ ] Webhook –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (6+ –º–µ—Å—è—Ü–µ–≤)
- [ ] –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- [ ] –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Ñ–∏—Ç–Ω–µ—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Polar
- [Polar AccessLink API](https://www.polar.com/accesslink/)
- [OAuth 2.0 Guide](https://www.polar.com/accesslink/api/oauth2)
- [API Reference](https://www.polar.com/accesslink/api/)

### –ö–æ–Ω—Ç–∞–∫—Ç—ã
- Polar Developer Support: developer@polar.com
- T-Sync Team: support@t-sync.com

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Polar Flow —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –ø—Ä–æ–µ–∫—Ç–∞ T-Sync –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ —Ç–æ–π –∂–µ –ª–∏—Ü–µ–Ω–∑–∏–µ–π.
